openapi: 3.0.3
info:
  title: Noise Map REST API
  version: 1.0.0
  description: |
    ğŸ§­ Location-based noise report API using Spring Boot
    - PostgreSQL: user, map, data, board
    - Elasticsearch: map, data, board indexing
    - Redis: user session sync

servers:
  - url: /api

tags:
  - name: User
  - name: Map
  - name: Noise Data
  - name: Board

paths:

  /user/signup:
    post:
      tags: [User]
      summary: ì‚¬ìš©ì íšŒì›ê°€ì…
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password, favoriteRegion]
              properties:
                email: { type: string, format: email }
                password: { type: string, format: password }
                favoriteRegion: { type: string }
      responses:
        '201':
          description: íšŒì›ê°€ì… ì„±ê³µ
        '400':
          description: ìœ íš¨ì„± ì‹¤íŒ¨

  /user/login:
    post:
      tags: [User]
      summary: ë¡œê·¸ì¸ ë° í† í° ë°œê¸‰
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string, format: password }
      responses:
        '200':
          description: ë¡œê·¸ì¸ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken: { type: string }
                  refreshToken: { type: string }

  /user/me:
    get:
      tags: [User]
      summary: ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
      security:
        - bearerAuth: []
      responses:
        '200':
          description: ì‚¬ìš©ì ì •ë³´ ë°˜í™˜
    put:
      tags: [User]
      summary: ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                favoriteRegion: { type: string }
      responses:
        '200':
          description: ìˆ˜ì • ì™„ë£Œ
  /user:
    delete:
      tags: [User]
      summary: íšŒì› íƒˆí‡´
      security:
        - bearerAuth: []
      responses:
        '204':
          description: íƒˆí‡´ ì™„ë£Œ

  /map:
    get:
      tags: [Map]
      summary: ë§µ ì •ë³´ ì „ì²´ ì¡°íšŒ
      responses:
        '200':
          description: ëª©ë¡ ë°˜í™˜
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Map'

  /map/{id}:
    get:
      tags: [Map]
      summary: íŠ¹ì • ë§µ ì •ë³´ ì¡°íšŒ
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: ë§µ ì •ë³´
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Map'

  /data:
    get:
      tags: [Noise Data]
      summary: ì†ŒìŒ ë°ì´í„° ì „ì²´ ì¡°íšŒ
      parameters:
        - name: mapId
          in: query
          required: false
          schema: { type: string }
      responses:
        '200':
          description: ì†ŒìŒ ëª©ë¡
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/NoiseData'

  /data/{id}:
    get:
      tags: [Noise Data]
      summary: íŠ¹ì • ì†ŒìŒ ë°ì´í„° ì¡°íšŒ
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: ì†ŒìŒ ì •ë³´
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NoiseData'

  /board:
    post:
      tags: [Board]
      summary: ê²Œì‹œê¸€ ì‘ì„±
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BoardCreate'
      responses:
        '201':
          description: ê²Œì‹œê¸€ ìƒì„±

    get:
      tags: [Board]
      summary: ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ
      parameters:
        - name: sigungu
          in: query
          schema: { type: string }
        - name: mood
          in: query
          schema:
            type: string
            enum: [good, not good, bad, terrible]
      responses:
        '200':
          description: ê²Œì‹œê¸€ ëª©ë¡
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Board'

  /board/{id}:
    get:
      tags: [Board]
      summary: ê²Œì‹œê¸€ ìƒì„¸ ì¡°íšŒ
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: ê²Œì‹œê¸€ ë°˜í™˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Board'
    put:
      tags: [Board]
      summary: ê²Œì‹œê¸€ ìˆ˜ì •
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BoardUpdate'
      responses:
        '200':
          description: ìˆ˜ì • ì™„ë£Œ
    delete:
      tags: [Board]
      summary: ê²Œì‹œê¸€ ì‚­ì œ
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '204':
          description: ì‚­ì œ ì™„ë£Œ

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    Map:
      type: object
      properties:
        id: { type: string }
        latitude: { type: number, format: float }
        longitude: { type: number, format: float }

    NoiseData:
      type: object
      properties:
        id: { type: string }
        mapId: { type: string }
        hour: { type: string, example: "14:00" }
        noiseLevel: { type: number, format: float }

    Board:
      type: object
      properties:
        boardId: { type: string }
        reg_userid: { type: string }
        title: { type: string }
        content: { type: string }
        sigungu: { type: string }
        eupmyeondong: { type: string }
        mood:
          type: string
          enum: [good, not good, bad, terrible]

    BoardCreate:
      type: object
      required: [title, content, sigungu, eupmyeondong, mood]
      properties:
        title: { type: string }
        content: { type: string }
        sigungu: { type: string }
        eupmyeondong: { type: string }
        mood:
          type: string
          enum: [good, not good, bad, terrible]

    BoardUpdate:
      type: object
      properties:
        title: { type: string }
        content: { type: string }
        mood:
          type: string
          enum: [good, not good, bad, terrible]
